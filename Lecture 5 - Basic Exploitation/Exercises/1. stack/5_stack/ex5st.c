
#include <stdio.h>
#include <stdlib.h>
#include <string.h>

#define NUM_OF_COMMANDS 4
typedef enum {SITTING, STANDING} dog_state;

dog_state state;

void secret()
{
  /* Unreachable (?) */
  printf("Congratulations, you win!\n");
  exit(0);
}

void sit()
{
	if (state == SITTING)
		printf("Already sitting.\n");
	else {
		state = SITTING;
		printf("Dog successfully sits.\n");
	}
}


void stand()
{
	if (state == STANDING)
		printf("Already standing.\n");
	else {
		state = STANDING;
		printf("Dog successfully stands.\n");
	}
}

void speak()
{
	printf("Woof!\n");
}

void bye()
{
	printf("Goodbye!\n");
	exit(0);
}


int main(int argc, char **argv)
{
	int command;
	int i;
	void (*handlers[NUM_OF_COMMANDS])() = {&sit, &stand, &speak, &bye};
	const char*  command_names[] = {"sit", "stand", "speak", "bye"} ;
	char buffer[0x40];
	/* What could possibly go wrong? */
	
	state = STANDING;
	printf("I am a dog.\n");
	printf("Available commands:\n");
	for (i=0;i<NUM_OF_COMMANDS;i++)
		printf("%s ", command_names[i]);
	printf("\n");
	while(1) {
		printf("Enter command: ");
		gets(buffer);
		
		command = -1;
		for (i=0;i<NUM_OF_COMMANDS;i++) {
			if (strcmp(buffer, command_names[i]) == 0) {
				command = i;
				break;
			}
		}
		if (command == -1) 
			printf("Unknown command. Dog is confused.\n");
		else 
			handlers[i]();
		
		
	}	
}


